<!-- æ¬¢è¿é¡µé¢æ¨¡æ€æ¡† V2 -->
<div id="welcomeModal" class="welcome-modal" style="display: none;">
    <div class="welcome-content">
        <div class="welcome-bg"></div>
        
        <div class="welcome-main">
            <h1 class="welcome-title">
                <span class="title-cn">ä¿®ä»™ä¸–ç•Œå¼•æ“</span>
                <span class="title-en">Xianxia World Engine</span>
            </h1>
            
            <div class="welcome-subtitle">
                <p>è¸å…¥ä»™é€”ï¼Œé€†å¤©æ”¹å‘½</p>
                <p class="subtitle-small">ä¸€å¿µæˆä»™ï¼Œä¸€å¿µæˆé­”</p>
            </div>
            
            <div class="game-intro">
                <h3>æ¸¸æˆç©æ³•</h3>
                <p>è¿™æ˜¯ä¸€ä¸ªæ–‡å­—ä¿®ä»™æ¸¸æˆï¼Œé€šè¿‡è¾“å…¥å‘½ä»¤æ¥è¿›è¡Œæ¸¸æˆã€‚</p>
                <p>ä½ å°†æ‰®æ¼”ä¸€åä¿®ä»™è€…ï¼Œä»å‡¡äººå¼€å§‹ï¼Œå†ç»åŠ«éš¾ï¼Œæœ€ç»ˆé£å‡æˆä»™ã€‚</p>
                <p>æ¢ç´¢ä¸–ç•Œã€ä¿®ç‚¼åŠŸæ³•ã€ç»“äº¤é“å‹ã€å¯»æ‰¾æœºç¼˜...</p>
            </div>
            
            <div class="welcome-buttons">
                <button class="welcome-btn welcome-btn-primary" onclick="GameLauncher.startNewGame()">
                    <span class="btn-icon">ğŸŒŸ</span>
                    <span class="btn-text">å¼€å§‹æ¸¸æˆ</span>
                </button>
                
                <button class="welcome-btn welcome-btn-secondary" onclick="GameLauncher.continueGame()">
                    <span class="btn-icon">ğŸ“–</span>
                    <span class="btn-text">ç»§ç»­æ¸¸æˆ</span>
                </button>
                
                <button class="welcome-btn welcome-btn-dev" onclick="GameLauncher.enterDevMode()">
                    <span class="btn-icon">ğŸ”§</span>
                    <span class="btn-text">å¼€å‘è€…æ¨¡å¼</span>
                </button>
            </div>
            
            <div class="welcome-footer">
                <p>Â© 2025 ä¿®ä»™ä¸–ç•Œå¼•æ“ | v1.0.0</p>
            </div>
        </div>
    </div>
</div>

<!-- èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨ -->
<audio id="bgMusic" loop>
    <source src="" type="audio/mpeg">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
</audio>

<style>
/* æ¬¢è¿é¡µé¢æ ·å¼ V2 */
.welcome-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 20000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.welcome-content {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.welcome-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(ellipse at center, rgba(180, 180, 180, 0.1) 0%, transparent 70%),
        linear-gradient(180deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
}

.welcome-main {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    padding: 20px;
}

.welcome-title {
    margin: 0 0 20px 0;
    animation: titleFadeIn 1s ease-out;
}

.title-cn {
    display: block;
    font-size: 60px;
    font-weight: bold;
    background: linear-gradient(135deg, #bbb 0%, #ddd 50%, #bbb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
    letter-spacing: 10px;
}

.title-en {
    display: block;
    font-size: 24px;
    color: rgba(180, 180, 180, 0.7);
    font-style: italic;
    letter-spacing: 5px;
}

.welcome-subtitle {
    margin-bottom: 30px;
    animation: subtitleFadeIn 1.5s ease-out;
}

.welcome-subtitle p {
    margin: 10px 0;
    color: #ddd;
    font-size: 20px;
    opacity: 0.9;
}

.subtitle-small {
    font-size: 16px !important;
    color: rgba(180, 180, 180, 0.6) !important;
}

/* æ¸¸æˆä»‹ç» */
.game-intro {
    max-width: 600px;
    margin: 0 auto 40px;
    padding: 20px;
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(180, 180, 180, 0.3);
    border-radius: 10px;
    animation: introFadeIn 2s ease-out;
}

.game-intro h3 {
    color: #bbb;
    margin: 0 0 15px 0;
    font-size: 24px;
}

.game-intro p {
    color: #e0e0e0;
    line-height: 1.6;
    margin: 10px 0;
}

/* æŒ‰é’®ç»„ */
.welcome-buttons {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 60px;
    animation: buttonsFadeIn 2.5s ease-out;
}

.welcome-btn {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    width: 300px;
    padding: 18px 30px;
    border: none;
    border-radius: 50px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    overflow: hidden;
}

.welcome-btn:hover {
    transform: translateY(-2px);
}

.btn-icon {
    font-size: 24px;
}

.welcome-btn-primary {
    background: linear-gradient(135deg, #bbb 0%, #ddd 100%);
    color: #1a1a2e;
    box-shadow: 0 5px 20px rgba(180, 180, 180, 0.3);
}

.welcome-btn-primary:hover {
    box-shadow: 0 8px 30px rgba(180, 180, 180, 0.5);
}

.welcome-btn-secondary {
    background: rgba(180, 180, 180, 0.1);
    color: #bbb;
    border: 2px solid #bbb;
}

.welcome-btn-secondary:hover {
    background: rgba(180, 180, 180, 0.2);
}

.welcome-btn-dev {
    background: rgba(100, 100, 100, 0.2);
    color: #888;
    border: 2px solid #666;
}

.welcome-btn-dev:hover {
    background: rgba(100, 100, 100, 0.3);
    border-color: #888;
    color: #aaa;
}

.welcome-footer {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    color: #666;
    font-size: 14px;
}

/* åŠ¨ç”» */
@keyframes titleFadeIn {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes subtitleFadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes introFadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

@keyframes buttonsFadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
/**
 * æ¸¸æˆå¯åŠ¨å™¨
 */
const GameLauncher = {
    // éŸ³ä¹åˆ—è¡¨
    musicList: [
        '/static/audio/bgm1.mp3',
        '/static/audio/bgm2.mp3',
        '/static/audio/bgm3.mp3'
    ],
    
    /**
     * åˆå§‹åŒ–
     */
    init() {
        // åˆå§‹åŒ–èƒŒæ™¯éŸ³ä¹
        this.initMusic();
        
        // æ£€æŸ¥å¼€å‘è€…æ¨¡å¼
        if (localStorage.getItem('devMode') === 'true') {
            console.log('å¼€å‘è€…æ¨¡å¼å·²å¯ç”¨');
            window.DEV_MODE = true;
        }
    },
    
    /**
     * åˆå§‹åŒ–èƒŒæ™¯éŸ³ä¹
     */
    initMusic() {
        const audio = document.getElementById('bgMusic');
        if (audio && this.musicList.length > 0) {
            // éšæœºé€‰æ‹©ä¸€é¦–éŸ³ä¹
            const randomIndex = Math.floor(Math.random() * this.musicList.length);
            audio.src = this.musicList[randomIndex];
            
            // è®¾ç½®éŸ³é‡
            audio.volume = 0.3;
            
            // å°è¯•è‡ªåŠ¨æ’­æ”¾
            audio.play().catch(e => {
                console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’');
                // åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶æ’­æ”¾
                document.addEventListener('click', () => {
                    audio.play();
                }, { once: true });
            });
        }
    },
    
    /**
     * å¼€å§‹æ–°æ¸¸æˆ
     */
    startNewGame() {
        // éšè—æ¬¢è¿é¡µé¢
        this.hide();
        
        // æ¸…é™¤æ—§æ•°æ®
        if (typeof GameUI !== 'undefined' && GameUI.clearGameData) {
            GameUI.clearGameData();
        }
        
        // æ˜¾ç¤ºè§’è‰²åˆ›å»ºé¢æ¿
        setTimeout(() => {
            if (typeof RollSystem !== 'undefined') {
                RollSystem.show(() => {
                    // è§’è‰²åˆ›å»ºå®Œæˆåï¼Œæ˜¾ç¤ºä¸–ç•ŒèƒŒæ™¯ä»‹ç»
                    this.showWorldIntro();
                });
            }
        }, 300);
    },
    
    /**
     * ç»§ç»­æ¸¸æˆ
     */
    continueGame() {
        // å°è¯•åŠ è½½å­˜æ¡£
        fetch('/load_game', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.hide();
                    // åˆ·æ–°æ¸¸æˆçŠ¶æ€
                    if (typeof GameUI !== 'undefined' && GameUI.refreshStatus) {
                        GameUI.refreshStatus();
                    }
                } else {
                    alert('æ²¡æœ‰æ‰¾åˆ°å­˜æ¡£ï¼Œè¯·å¼€å§‹æ–°æ¸¸æˆ');
                }
            })
            .catch(error => {
                console.error('åŠ è½½å­˜æ¡£å¤±è´¥:', error);
                alert('åŠ è½½å­˜æ¡£å¤±è´¥');
            });
    },
    
    /**
     * è¿›å…¥å¼€å‘è€…æ¨¡å¼
     */
    enterDevMode() {
        const password = prompt('è¯·è¾“å…¥å¼€å‘è€…å¯†ç ï¼š');
        if (password === 'dev123') {  // å¯ä»¥ä¿®æ”¹ä¸ºæ›´å®‰å…¨çš„å¯†ç 
            localStorage.setItem('devMode', 'true');
            window.DEV_MODE = true;
            
            // æ·»åŠ å¼€å‘è€…æ§åˆ¶å°
            this.initDevConsole();
            
            alert('å¼€å‘è€…æ¨¡å¼å·²å¯ç”¨ï¼\n- æŒ‰F12æŸ¥çœ‹æ§åˆ¶å°\n- æ‰€æœ‰é”™è¯¯å°†è¯¦ç»†æ˜¾ç¤º\n- å¯ä½¿ç”¨è°ƒè¯•å‘½ä»¤');
            this.hide();
        } else {
            alert('å¯†ç é”™è¯¯ï¼');
        }
    },
    
    /**
     * åˆå§‹åŒ–å¼€å‘è€…æ§åˆ¶å°
     */
    initDevConsole() {
        // è¦†ç›–consoleæ–¹æ³•ä»¥ä¾¿æ›´å¥½åœ°è°ƒè¯•
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog('[DEV]', new Date().toISOString(), ...args);
        };
        
        console.error = function(...args) {
            originalError('[ERROR]', new Date().toISOString(), ...args);
            // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºé”™è¯¯
            if (window.DEV_MODE) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'dev-error';
                errorDiv.textContent = `é”™è¯¯: ${args.join(' ')}`;
                document.body.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 5000);
            }
        };
        
        // æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            console.error('å…¨å±€é”™è¯¯:', event.error);
        });
    },
    
    /**
     * æ˜¾ç¤ºä¸–ç•ŒèƒŒæ™¯ä»‹ç»
     */
    showWorldIntro() {
        if (typeof WorldIntroSystem !== 'undefined') {
            WorldIntroSystem.show(() => {
                console.log('ä¸–ç•Œä»‹ç»å®Œæˆï¼Œæ¸¸æˆæ­£å¼å¼€å§‹');
            });
        }
    },
    
    /**
     * æ˜¾ç¤ºæ¬¢è¿é¡µé¢
     */
    show() {
        const modal = document.getElementById('welcomeModal');
        if (modal) {
            modal.style.display = 'flex';
            this.init();
        }
    },
    
    /**
     * éšè—æ¬¢è¿é¡µé¢
     */
    hide() {
        const modal = document.getElementById('welcomeModal');
        if (modal) {
            modal.style.opacity = '0';
            modal.style.transition = 'opacity 0.5s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
                modal.style.opacity = '1';
            }, 500);
        }
    }
};

// å¯¼å‡ºåˆ°å…¨å±€
window.GameLauncher = GameLauncher;

// å¼€å‘è€…æ¨¡å¼é”™è¯¯æ ·å¼
const devStyle = document.createElement('style');
devStyle.textContent = `
.dev-error {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(255, 0, 0, 0.9);
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    font-size: 14px;
    z-index: 99999;
    max-width: 400px;
    word-wrap: break-word;
}
`;
document.head.appendChild(devStyle);
</script>