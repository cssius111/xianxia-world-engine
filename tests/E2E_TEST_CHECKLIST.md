# E2E 测试清单 (Checklist)

## ✅ 核心功能测试 (tests/e2e_full.spec.ts)

### 1. Web UI 首屏渲染
- [ ] 访问首页返回 200 状态码
- [ ] 页面标题包含"修仙世界引擎"
- [ ] 页面正确重定向到 intro/game
- [ ] 核心 UI 元素存在

### 2. 角色创建流程
- [ ] 成功导航到角色创建页面
- [ ] "开始新游戏"按钮可见且可点击
- [ ] 角色名称输入框正常工作
- [ ] 创建按钮提交表单成功
- [ ] 收到创建成功响应

### 3. 异步探索 API
- [ ] POST /api/explore_async 创建任务
- [ ] 返回有效的 task_id
- [ ] 等待 200ms 后轮询状态
- [ ] GET /api/explore_status/{task_id} 返回状态
- [ ] 最终状态为 "done" 且包含 reward
- [ ] 降级到同步 API 如果异步不可用

### 4. 状态管理
- [ ] POST /api/state 写入状态转换
- [ ] 第一次转换: IDLE/EXPLORING → EXPLORING
- [ ] 第二次转换: EXPLORING → COMBAT
- [ ] state_transitions.log 文件生成
- [ ] 日志包含正确的 from/to 字段
- [ ] 时间戳格式正确

### 5. 缓存机制
- [ ] 第一次请求 /api/data/lore 记录时间
- [ ] 第二次请求响应时间更快（缓存命中）
- [ ] 响应头包含缓存相关信息
- [ ] TTL 过期后的行为正确

### 6. 日志轮转
- [ ] 清理旧日志文件
- [ ] 写入数据超过 LOG_MAX_BYTES
- [ ] app.log.1.gz 文件生成
- [ ] 原始 app.log 被截断
- [ ] 压缩文件可读

### 7. 视觉测试
- [ ] 游戏界面截图生成
- [ ] 截图保存到 test-results/
- [ ] 图片清晰完整

## ✅ 扩展功能测试 (tests/e2e_extended.spec.ts)

### 8. 游戏命令系统
- [ ] 帮助命令返回命令列表
- [ ] 移动命令更新位置
- [ ] 背包命令显示物品
- [ ] 修炼命令返回修炼信息
- [ ] 命令解析结果包含 handler 和 params

### 9. 数据接口
- [ ] GET /data/destiny 返回命格数据
- [ ] GET /data/fortune 返回气运数据
- [ ] GET /data/templates 返回角色模板
- [ ] 所有数据接口返回 JSON 格式

### 10. 存档系统
- [ ] POST /save_game 保存成功
- [ ] POST /load_game 加载成功
- [ ] 存档文件创建在 saves/ 目录
- [ ] 加载后状态恢复正确

### 11. NLP 功能
- [ ] 自然语言命令正确解析
- [ ] "我想去探索" → explore handler
- [ ] "查看状态" → status handler
- [ ] NLP 缓存信息可获取
- [ ] 缓存清除功能正常

### 12. 抽卡系统
- [ ] 随机抽卡生成角色属性
- [ ] 模板抽卡按类型生成
- [ ] 属性包含: constitution, comprehension, spirit, luck
- [ ] 命格正确分配

### 13. 错误处理
- [ ] 404 页面返回正确状态码
- [ ] 无效命令返回 unknown handler
- [ ] 空请求不会崩溃
- [ ] 错误信息友好可读

### 14. 并发测试
- [ ] 5 个并发创建角色请求成功
- [ ] 3 个并发探索请求成功
- [ ] 无竞态条件或死锁
- [ ] 响应时间在合理范围

### 15. 日志监控
- [ ] 测试日志写入成功
- [ ] 日志内容正确
- [ ] 日志清理功能正常

### 16. 界面交互
- [ ] 输入框和按钮存在
- [ ] 1920x1080 响应式正常
- [ ] 768x1024 平板视图正常
- [ ] 375x667 手机视图正常
- [ ] 所有尺寸截图生成

### 17. 模态框
- [ ] help 模态框加载
- [ ] inventory 模态框加载
- [ ] status 模态框加载
- [ ] 内容正确显示

### 18. SSE 测试
- [ ] EventSource 连接建立
- [ ] 接收到状态更新消息
- [ ] 消息格式正确
- [ ] 连接正常关闭

### 19. 性能基准
- [ ] Status API < 100ms
- [ ] Lore API < 200ms
- [ ] Destiny Data < 150ms
- [ ] Command API < 500ms
- [ ] 平均响应时间符合预期

### 20. 内存使用
- [ ] JS Heap 使用量记录
- [ ] 内存使用在合理范围
- [ ] 无明显内存泄漏

## 📊 测试统计

- **总测试数**: 20 个测试场景
- **总断言数**: 100+ 个
- **浏览器覆盖**: Chrome, Firefox, Safari, Mobile
- **API 端点**: 15+ 个
- **性能指标**: 10+ 个

## 🏆 测试通过标准

- ✅ 所有核心功能测试通过
- ✅ 80% 以上扩展测试通过
- ✅ 无崩溃或严重错误
- ✅ 性能指标在预期范围内
- ✅ 跨浏览器兼容性良好

## 📝 备注

- 使用 `expect.soft()` 确保测试继续执行
- 某些功能可能未实现，使用降级处理
- 测试结果保存在 `test-results/` 目录
- HTML 报告在 `playwright-report/` 目录
