# 修仙世界引擎数据结构重构总结

## 📋 数据文件概览

| 文件名 | 描述 | 主要内容 | 依赖关系 |
|--------|------|----------|----------|
| `attribute_model.json` | 属性模型定义 | 基础属性、修炼属性、衍生属性 | 被所有其他系统引用 |
| `cultivation_realm.json` | 境界体系定义 | 9大境界、突破机制、天劫系统 | 依赖属性模型 |
| `spiritual_root.json` | 灵根体系定义 | 5种基础灵根、特殊灵根、品质等级 | 依赖属性模型 |
| `combat_system.json` | 战斗系统定义 | 战斗流程、伤害计算、状态效果 | 依赖属性、境界、技能 |
| `event_template.json` | 事件模板定义 | 事件类型、触发条件、选择分支 | 依赖NPC、物品模板 |
| `npc_template.json` | NPC模板定义 | NPC原型、行为树、对话系统 | 依赖属性模型 |
| `item_template.json` | 物品模板定义 | 8大类物品、品质系统、强化机制 | 独立模块 |
| `faction_model.json` | 势力体系定义 | 9层势力等级、外交系统、战争机制 | 依赖NPC、技能系统 |
| `formula_library.json` | 公式库定义 | 所有计算公式集中管理 | 被所有系统引用 |
| `system_config.json` | 系统配置 | 引擎设置、功能开关、性能参数 | 全局配置 |

## 🔗 核心数据关系

### 属性体系关系图
```
attribute_model.json
    ├─→ cultivation_realm.json (境界影响属性成长)
    ├─→ spiritual_root.json (灵根影响修炼速度)
    ├─→ combat_system.json (属性决定战斗数值)
    └─→ npc_template.json (NPC使用相同属性体系)
```

### 公式引用关系
```
formula_library.json
    ├─→ health_calculation (生命值计算)
    ├─→ damage formulas (伤害计算)
    ├─→ breakthrough_chance (突破概率)
    ├─→ cultivation_speed (修炼速度)
    └─→ 20+ 其他公式
```

## 📊 关键数据统计

### 境界体系
| 境界 | 等级 | 寿命加成 | 力量倍数 | 特殊能力 |
|------|------|----------|----------|----------|
| 聚气期 | 1-9 | 0 | 1x | 基础修炼 |
| 筑基期 | 1-9 | 50年 | 3x | 神识、飞行 |
| 金丹期 | 1-9 | 200年 | 10x | 领域投影 |
| 元婴期 | 1-9 | 800年 | 50x | 元婴出窍 |
| 化神期 | 1-9 | 3000年 | 200x | 法则掌控 |
| 炼虚期 | 1-9 | 10000年 | 1000x | 虚实转换 |
| 合体期 | 1-9 | 50000年 | 5000x | 言出法随 |
| 大乘期 | 1-9 | 999999年 | 20000x | 改写现实 |
| 渡劫期 | 1-9 | 无限 | 100000x | 飞升成仙 |

### 灵根分布
| 灵根类型 | 出现概率 | 修炼速度 | 特殊路径 |
|----------|----------|----------|----------|
| 单灵根 | 1% | 5.0x | 元素掌控大师 |
| 双灵根 | 5% | 3.0x | 融合技能 |
| 三灵根 | 15% | 2.0x | 平衡发展 |
| 四灵根 | 29% | 1.5x | 全能型 |
| 五灵根 | 50% | 1.0x | 阵法大师/混沌体质 |

### 物品品质系统
| 品质 | 颜色 | 价值倍数 | 掉落权重 | 掉落率 |
|------|------|----------|----------|---------|
| 凡品 | 白色 | 1.0x | 1000 | 80% |
| 精品 | 绿色 | 2.5x | 400 | 15% |
| 稀有 | 蓝色 | 5.0x | 150 | 4% |
| 史诗 | 紫色 | 10.0x | 40 | 0.9% |
| 传说 | 橙色 | 25.0x | 9 | 0.09% |
| 神话 | 红色 | 100.0x | 1 | 0.01% |

### 势力等级体系
| 等级 | 名称 | 成员要求 | 最高境界要求 | 影响力要求 |
|------|------|----------|--------------|-------------|
| 1级 | 初创势力 | ≥3 | 无 | ≥10 |
| 2级 | 散修联盟 | ≥10 | 无 | ≥50 |
| 3级 | 修炼世家 | ≥20 | 筑基期 | ≥100 |
| 4级 | 小型宗门 | ≥50 | 金丹期 | ≥500 |
| 5级 | 三流宗门 | ≥100 | 元婴期 | ≥1000 |
| 6级 | 二流宗门 | ≥500 | 化神期 | ≥5000 |
| 7级 | 一流宗门 | ≥1000 | 炼虚期 | ≥10000 |
| 8级 | 顶级宗门 | ≥5000 | 合体期 | ≥50000 |
| 9级 | 至尊圣地 | ≥10000 | 大乘期 | ≥100000 |

## 🎯 数据设计亮点

### 1. 模块化设计
- 每个JSON文件负责独立的游戏系统
- 通过ID引用实现模块间关联
- 支持热更新和动态加载

### 2. 公式集中管理
- 所有计算公式统一存储在`formula_library.json`
- 支持变量替换和表达式嵌套
- 便于平衡性调整

### 3. 扩展性设计
- 每个文件都包含`_custom_tags`字段
- 支持MOD系统扩展
- 预留了plugin_hooks接口

### 4. 数据验证
- 每个数据文件都有对应的JSON Schema
- 支持自动验证和错误提示
- 确保数据完整性

## 🔧 使用建议

### 开发集成
1. 先加载`system_config.json`初始化引擎
2. 按依赖顺序加载其他数据文件
3. 使用`formula_library.json`进行所有数值计算
4. 通过Schema验证数据修改的合法性

### 数据修改
1. 修改前先备份原始文件
2. 使用JSON Schema验证修改后的数据
3. 注意维护引用关系的完整性
4. 测试修改对游戏平衡性的影响

### 性能优化
1. 缓存常用的公式计算结果
2. 使用索引加速数据查找
3. 懒加载大型数据文件
4. 定期清理过期的临时数据

## 📝 版本管理

所有数据文件统一使用语义化版本号（Semantic Versioning）：
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

当前版本：**3.0.0**

---

*修仙世界引擎数据重构完成于 2025-06-07*