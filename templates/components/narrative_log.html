<!-- å™äº‹æ—¥å¿—åŒºåŸŸ -->
<div class="narrative-log" id="narrativeLog">
    <div class="log-content" id="logContent">
        <!-- åˆå§‹æ¬¢è¿ä¿¡æ¯ -->
        <div class="log-entry welcome-entry">
            <p>æ¬¢è¿æ¥åˆ°ä¿®ä»™ä¸–ç•Œï¼</p>
            <p>ä½ æ˜¯<strong>{{ player.name|default('æ— åä¾ å®¢') }}</strong>ï¼Œä¸€ä¸ªåˆšåˆšè¸å…¥ä¿®ä»™ä¹‹è·¯çš„{{ player.attributes.realm_name|default('ç‚¼æ°”æœŸ') }}ä¿®å£«ã€‚</p>
            <p>ä½ ç°åœ¨ä½äº<strong>{{ location|default('é’äº‘åŸ') }}</strong>ï¼Œè¿™æ˜¯ä¸€åº§ç¹åçš„ä¿®çœŸåŸå¸‚ï¼Œæ— æ•°ä¿®å£«åœ¨æ­¤äº¤æ˜“ã€ä¿®ç‚¼ã€æ¢ç´¢ã€‚</p>
            <p class="tip">è¾“å…¥å‘½ä»¤å¼€å§‹ä½ çš„å†’é™©ï¼Œæˆ–ç‚¹å‡»å·¦ä¾§èœå•æŸ¥çœ‹æ›´å¤šåŠŸèƒ½ã€‚</p>
        </div>
    </div>
</div>

<style>
.narrative-log {
    flex: 1;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 20px;
    overflow-y: auto;
    margin-bottom: 20px;
}

.log-content {
    font-size: 16px;
    line-height: 1.6;
    color: #e0e0e0;
}

.log-entry {
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
    border-left: 3px solid rgba(180, 180, 180, 0.5);
    animation: fadeIn 0.5s ease;
}

.log-entry p {
    margin: 10px 0;
}

.log-entry strong {
    color: #bbb;
}

.welcome-entry {
    border-left-color: #bbb;
    background: rgba(180, 180, 180, 0.05);
}

.log-entry.command {
    border-left-color: #4169E1;
    font-style: italic;
}

.log-entry.result {
    border-left-color: #32CD32;
}

.log-entry.error {
    border-left-color: #DC143C;
    color: #ff6b6b;
}

.log-entry.system {
    border-left-color: #FFD700;
    background: rgba(255, 215, 0, 0.05);
}

.tip {
    color: #aaa;
    font-size: 14px;
    font-style: italic;
}

/* æ—¶é—´æˆ³ */
.log-timestamp {
    font-size: 12px;
    color: #666;
    float: right;
}

/* æ»šåŠ¨æ¡ */
.narrative-log::-webkit-scrollbar {
    width: 8px;
}

.narrative-log::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
}

.narrative-log::-webkit-scrollbar-thumb {
    background: rgba(180, 180, 180, 0.5);
    border-radius: 4px;
}

/* åŠ¨ç”» */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ç‰¹æ®Šæ•ˆæœç±» */
.highlight {
    color: #FFD700;
    font-weight: bold;
}

.damage {
    color: #DC143C;
}

.heal {
    color: #32CD32;
}

.reward {
    color: #4169E1;
}

/* å“åº”å¼ */
@media (max-width: 768px) {
    .log-content {
        font-size: 14px;
    }
}
</style>

<script>
/**
 * å™äº‹æ—¥å¿—ç®¡ç†å™¨
 */
const NarrativeLog = {
    /**
     * æ·»åŠ æ—¥å¿—æ¡ç›®
     * @param {string} content - æ—¥å¿—å†…å®¹
     * @param {string} type - æ—¥å¿—ç±»å‹ (normal, command, result, error, system)
     */
    addEntry(content, type = 'normal') {
        const logContent = document.getElementById('logContent');
        const entry = document.createElement('div');
        entry.className = `log-entry ${type}`;
        
        // æ·»åŠ æ—¶é—´æˆ³
        const timestamp = new Date().toLocaleTimeString('zh-CN', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        
        entry.innerHTML = `
            <span class="log-timestamp">${timestamp}</span>
            ${content}
        `;
        
        logContent.appendChild(entry);
        
        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        const narrativeLog = document.getElementById('narrativeLog');
        narrativeLog.scrollTop = narrativeLog.scrollHeight;
        
        // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
        this.limitEntries();
    },
    
    /**
     * é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
     */
    limitEntries() {
        const logContent = document.getElementById('logContent');
        const entries = logContent.getElementsByClassName('log-entry');
        
        // ä¿ç•™æœ€å¤š50æ¡è®°å½•
        while (entries.length > 50) {
            logContent.removeChild(entries[0]);
        }
    },
    
    /**
     * æ¸…ç©ºæ—¥å¿—
     */
    clear() {
        const logContent = document.getElementById('logContent');
        logContent.innerHTML = '';
    },
    
    /**
     * æ·»åŠ å‘½ä»¤æ—¥å¿—
     */
    addCommand(command) {
        this.addEntry(`<p>> ${command}</p>`, 'command');
    },
    
    /**
     * æ·»åŠ ç»“æœæ—¥å¿—
     */
    addResult(result) {
        this.addEntry(`<p>${result}</p>`, 'result');
    },
    
    /**
     * æ·»åŠ é”™è¯¯æ—¥å¿—
     */
    addError(error) {
        this.addEntry(`<p>âŒ ${error}</p>`, 'error');
    },
    
    /**
     * æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯
     */
    addSystem(message) {
        this.addEntry(`<p>ğŸ“¢ ${message}</p>`, 'system');
    }
};

// å¯¼å‡ºåˆ°å…¨å±€
window.NarrativeLog = NarrativeLog;
</script>
