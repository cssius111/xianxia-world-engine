<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>修仙世界引擎 v2.0</title>
    <meta name="description" content="沉浸式文字修真模拟器，体验完整的修仙世界">
    <meta name="keywords" content="修仙,文字游戏,RPG,修真模拟">
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="/static/css/game_optimized.css" as="style">
    <link rel="preload" href="/static/js/game_optimized.js" as="script">
    
    <!-- 样式表 -->
    <link rel="stylesheet" href="/static/css/game_optimized.css">
    
    <!-- 图标 -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='70' font-family='serif' font-size='60' fill='%23888' text-anchor='middle'>仙</text></svg>">
    
    <!-- SEO优化 -->
    <meta property="og:title" content="修仙世界引擎">
    <meta property="og:description" content="沉浸式文字修真模拟器">
    <meta property="og:type" content="game">
</head>
<body>
    {% if dev_mode %}
    <!-- 开发模式横幅 -->
    <div class="dev-banner">
        [DEV DEBUG MODE] - 开发者调试模式已启用
    </div>
    {% endif %}
    
    <!-- 顶部区域 -->
    <header class="header{% if dev_mode %} with-dev-banner{% endif %}" role="banner">
        <h1>修仙世界引擎</h1>
        <div class="subtitle">——沉浸式文字修真模拟——</div>
        <div class="dragon-seal" aria-hidden="true"></div>
    </header>

    <!-- 主体容器 -->
    <main class="main-container" role="main">
        <!-- 左侧状态栏 -->
        <aside class="sidebar" role="complementary" aria-label="角色状态和功能菜单">
            <section class="status-block">
                <h2>角色状态</h2>
                <div class="status-line">
                    <span class="status-label">姓名</span>
                    <span class="status-value" id="player-name">{{ player.name if player else '无名侠客' }}
                        <span class="sub-value" id="faction">({{ player.extra_data.faction if player and player.extra_data and player.extra_data.faction else '正道' }})</span>
                    </span>
                </div>
                <div class="status-line">
                    <span class="status-label">境界</span>
                    <span class="status-value" id="realm">{{ player.attributes.realm_name if player else '炼气期' }}
                        <span class="sub-value" id="realm-progress">({{ player.attributes.realm_progress if player else 0 }}%)</span>
                    </span>
                </div>
            </section>

            <section class="status-block">
                <h2>生命状态</h2>
                <div class="status-line">
                    <span class="status-label">气血</span>
                    <span class="status-value" id="health">{{ player.attributes.current_health if player else 100 }} / {{ player.attributes.max_health if player else 100 }}</span>
                </div>
                <div class="progress-bar" role="progressbar" aria-label="气血值">
                    <div class="progress-fill health" id="health-progress" style="width: {{ (player.attributes.current_health / player.attributes.max_health * 100) if player else 100 }}%"></div>
                </div>

                <div class="status-line">
                    <span class="status-label">灵力</span>
                    <span class="status-value" id="mana">{{ player.attributes.current_mana if player else 50 }} / {{ player.attributes.max_mana if player else 50 }}</span>
                </div>
                <div class="progress-bar" role="progressbar" aria-label="灵力值">
                    <div class="progress-fill mana" id="mana-progress" style="width: {{ (player.attributes.current_mana / player.attributes.max_mana * 100) if player else 100 }}%"></div>
                </div>

                {% if player and player.attributes.current_stamina %}
                <div class="status-line">
                    <span class="status-label">体力</span>
                    <span class="status-value" id="stamina">{{ player.attributes.current_stamina }} / {{ player.attributes.max_stamina }}</span>
                </div>
                <div class="progress-bar" role="progressbar" aria-label="体力值">
                    <div class="progress-fill stamina" id="stamina-progress" style="width: {{ (player.attributes.current_stamina / player.attributes.max_stamina * 100) }}%"></div>
                </div>
                {% endif %}
            </section>

            <section class="status-block">
                <h2>位置信息</h2>
                <div class="status-line">
                    <span class="status-label">当前位置</span>
                    <span class="status-value" id="location">{{ location if location else '青云城' }}</span>
                </div>
                <div class="status-line">
                    <span class="status-label">灵石</span>
                    <span class="status-value" id="gold">0</span>
                </div>
            </section>

            <section class="status-block">
                <h2>状态效果</h2>
                <div class="status-list" id="buff-list" aria-label="增益效果">
                    {% for buff in buffs %}
                    <div class="status-list-item">{{ buff }}</div>
                    {% else %}
                    <div class="status-list-item">（无增益）</div>
                    {% endfor %}
                </div>
            </section>

            <section class="status-block">
                <h2>特殊状态</h2>
                <div class="status-list" id="special-status" aria-label="特殊状态">
                    {% for status in special_status %}
                    <div class="status-list-item">{{ status }}</div>
                    {% else %}
                    <div class="status-list-item">（正常）</div>
                    {% endfor %}
                </div>
            </section>

            <!-- 功能网格 -->
            <nav class="function-grid" role="navigation" aria-label="游戏功能菜单">
                <button class="function-link" data-modal="status" aria-label="查看详细状态">状态</button>
                <button class="function-link" data-modal="inventory" aria-label="查看背包物品">背包</button>
                <button class="function-link" data-modal="cultivation" aria-label="修炼系统">修炼</button>
                <button class="function-link" data-modal="achievement" aria-label="查看成就">成就</button>
                <button class="function-link" data-modal="exploration" aria-label="探索功能">探索</button>
                <button class="function-link" data-modal="map" aria-label="查看地图">地图</button>
                <button class="function-link" data-modal="quest" aria-label="查看任务">任务</button>
                <button class="function-link" data-modal="save" aria-label="保存游戏">保存</button>
                <button class="function-link" data-modal="load" aria-label="加载游戏">加载</button>
                <button class="function-link" data-modal="help" aria-label="查看帮助">帮助</button>
                <button class="function-link" data-modal="settings" aria-label="游戏设置">设定</button>
                <button class="function-link" data-modal="exit" aria-label="退出游戏">退出</button>
            </nav>

            <!-- 成就进度 -->
            <section class="achievement-progress" aria-label="成就进度">
                <div>成就：<span id="achievement-count" aria-label="已解锁成就数量">0/30</span></div>
                <div>成就点：<span id="achievement-points" aria-label="获得成就点数">0</span></div>
            </section>
        </aside>

        <!-- 中央叙事区域 -->
        <section class="narrative-log" id="narrative-log" role="log" aria-label="游戏剧情和系统消息" aria-live="polite">
            <div class="loading" id="loading" aria-label="正在加载游戏">
                <div class="loading-spinner" aria-hidden="true"></div>
                <div>正在唤醒修仙世界...</div>
            </div>
        </section>
    </main>

    <!-- 底部命令区 -->
    <footer class="command-section" role="contentinfo">
        <div class="input-hint">💡 输入"帮助"查看全部可用命令，按Tab键显示命令提示</div>
        <form class="input-line" onsubmit="event.preventDefault(); gameClient.executeCommand();" role="search">
            <label for="command-input" class="sr-only">游戏命令输入</label>
            <input type="text"
                   class="command-input"
                   id="command-input"
                   placeholder="输入命令，如：探索、攻击妖兽、使用回元丹……"
                   autocomplete="off"
                   spellcheck="false"
                   aria-describedby="input-hint"
                   maxlength="100">
            <button type="submit" class="command-submit" aria-label="执行输入的命令">执行</button>
        </form>
        
        <!-- 自动完成提示 -->
        <div class="autocomplete" id="autocomplete" role="listbox" aria-label="命令建议"></div>
    </footer>

    <!-- 浮动提示 -->
    <div class="tooltip" id="tooltip" role="tooltip" aria-hidden="true"></div>
    
    <!-- 通用模态框 -->
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-container">
            <button class="modal-close" aria-label="关闭对话框">&times;</button>
            <div id="modal-content">
                <!-- 动态加载内容 -->
            </div>
        </div>
    </div>

    <!-- 无障碍辅助 -->
    <div class="sr-only" aria-live="assertive" id="screen-reader-announcements"></div>

    <!-- 脚本加载 -->
    <script>
        // 设置全局变量
        window.devMode = {{ 'true' if dev_mode else 'false' }};
        window.isNewSession = {{ 'true' if is_new_session else 'false' }};
        
        // 性能监控
        if (window.performance && window.performance.mark) {
            window.performance.mark('game-start');
        }
        
        // 错误处理
        window.addEventListener('error', function(e) {
            if (window.devMode) {
                console.error('[DEV] JavaScript错误:', e.error);
            }
        });
        
        // 未处理的Promise拒绝
        window.addEventListener('unhandledrejection', function(e) {
            if (window.devMode) {
                console.error('[DEV] 未处理的Promise拒绝:', e.reason);
            }
        });
    </script>
    
    <!-- 游戏核心脚本 -->
    <script src="/static/js/game_optimized.js" defer></script>
    
    <!-- 可选：性能分析（仅开发模式） -->
    {% if dev_mode %}
    <script>
        // 开发模式下的性能监控
        window.addEventListener('load', function() {
            if (window.performance && window.performance.getEntriesByType) {
                setTimeout(function() {
                    const navigation = window.performance.getEntriesByType('navigation')[0];
                    if (navigation) {
                        console.log('[DEV] 页面加载性能:');
                        console.log('  DNS查找:', Math.round(navigation.domainLookupEnd - navigation.domainLookupStart), 'ms');
                        console.log('  TCP连接:', Math.round(navigation.connectEnd - navigation.connectStart), 'ms');
                        console.log('  请求响应:', Math.round(navigation.responseEnd - navigation.requestStart), 'ms');
                        console.log('  DOM构建:', Math.round(navigation.domContentLoadedEventEnd - navigation.responseEnd), 'ms');
                        console.log('  总计时间:', Math.round(navigation.loadEventEnd - navigation.navigationStart), 'ms');
                    }
                }, 1000);
            }
        });
    </script>
    {% endif %}
</body>
</html>

<!-- 
    修仙世界引擎 v2.0
    一个沉浸式的文字修真模拟器
    
    特性:
    - 🎨 优雅的水墨风界面设计
    - 🎮 完整的修仙体验系统
    - 📱 响应式设计，支持多设备
    - ♿ 优秀的无障碍支持
    - 🚀 高性能优化
    - 🔧 开发者友好的调试功能
-->