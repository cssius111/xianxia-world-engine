<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ä¿®ä»™ä¸–ç•Œå¼•æ“ v2.0</title>
    <meta name="description" content="æ²‰æµ¸å¼æ–‡å­—ä¿®çœŸæ¨¡æ‹Ÿå™¨ï¼Œä½“éªŒå®Œæ•´çš„ä¿®ä»™ä¸–ç•Œ">
    <meta name="keywords" content="ä¿®ä»™,æ–‡å­—æ¸¸æˆ,RPG,ä¿®çœŸæ¨¡æ‹Ÿ">
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="/static/css/game_optimized.css" as="style">
    <link rel="preload" href="/static/js/game_optimized.js" as="script">
    
    <!-- æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="/static/css/game_optimized.css">
    
    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='70' font-family='serif' font-size='60' fill='%23888' text-anchor='middle'>ä»™</text></svg>">
    
    <!-- SEOä¼˜åŒ– -->
    <meta property="og:title" content="ä¿®ä»™ä¸–ç•Œå¼•æ“">
    <meta property="og:description" content="æ²‰æµ¸å¼æ–‡å­—ä¿®çœŸæ¨¡æ‹Ÿå™¨">
    <meta property="og:type" content="game">
</head>
<body>
    {% if dev_mode %}
    <!-- å¼€å‘æ¨¡å¼æ¨ªå¹… -->
    <div class="dev-banner">
        [DEV DEBUG MODE] - å¼€å‘è€…è°ƒè¯•æ¨¡å¼å·²å¯ç”¨
    </div>
    {% endif %}
    
    <!-- é¡¶éƒ¨åŒºåŸŸ -->
    <header class="header{% if dev_mode %} with-dev-banner{% endif %}" role="banner">
        <h1>ä¿®ä»™ä¸–ç•Œå¼•æ“</h1>
        <div class="subtitle">â€”â€”æ²‰æµ¸å¼æ–‡å­—ä¿®çœŸæ¨¡æ‹Ÿâ€”â€”</div>
        <div class="dragon-seal" aria-hidden="true"></div>
    </header>

    <!-- ä¸»ä½“å®¹å™¨ -->
    <main class="main-container" role="main">
        <!-- å·¦ä¾§çŠ¶æ€æ  -->
        <aside class="sidebar" role="complementary" aria-label="è§’è‰²çŠ¶æ€å’ŒåŠŸèƒ½èœå•">
            <section class="status-block">
                <h2>è§’è‰²çŠ¶æ€</h2>
                <div class="status-line">
                    <span class="status-label">å§“å</span>
                    <span class="status-value" id="player-name">{{ player.name if player else 'æ— åä¾ å®¢' }}
                        <span class="sub-value" id="faction">({{ player.extra_data.faction if player and player.extra_data and player.extra_data.faction else 'æ­£é“' }})</span>
                    </span>
                </div>
                <div class="status-line">
                    <span class="status-label">å¢ƒç•Œ</span>
                    <span class="status-value" id="realm">{{ player.attributes.realm_name if player else 'ç‚¼æ°”æœŸ' }}
                        <span class="sub-value" id="realm-progress">({{ player.attributes.realm_progress if player else 0 }}%)</span>
                    </span>
                </div>
            </section>

            <section class="status-block">
                <h2>ç”Ÿå‘½çŠ¶æ€</h2>
                <div class="status-line">
                    <span class="status-label">æ°”è¡€</span>
                    <span class="status-value" id="health">{{ player.attributes.current_health if player else 100 }} / {{ player.attributes.max_health if player else 100 }}</span>
                </div>
                <div class="progress-bar" role="progressbar" aria-label="æ°”è¡€å€¼">
                    <div class="progress-fill health" id="health-progress" style="width: {{ (player.attributes.current_health / player.attributes.max_health * 100) if player else 100 }}%"></div>
                </div>

                <div class="status-line">
                    <span class="status-label">çµåŠ›</span>
                    <span class="status-value" id="mana">{{ player.attributes.current_mana if player else 50 }} / {{ player.attributes.max_mana if player else 50 }}</span>
                </div>
                <div class="progress-bar" role="progressbar" aria-label="çµåŠ›å€¼">
                    <div class="progress-fill mana" id="mana-progress" style="width: {{ (player.attributes.current_mana / player.attributes.max_mana * 100) if player else 100 }}%"></div>
                </div>

                {% if player and player.attributes.current_stamina %}
                <div class="status-line">
                    <span class="status-label">ä½“åŠ›</span>
                    <span class="status-value" id="stamina">{{ player.attributes.current_stamina }} / {{ player.attributes.max_stamina }}</span>
                </div>
                <div class="progress-bar" role="progressbar" aria-label="ä½“åŠ›å€¼">
                    <div class="progress-fill stamina" id="stamina-progress" style="width: {{ (player.attributes.current_stamina / player.attributes.max_stamina * 100) }}%"></div>
                </div>
                {% endif %}
            </section>

            <section class="status-block">
                <h2>ä½ç½®ä¿¡æ¯</h2>
                <div class="status-line">
                    <span class="status-label">å½“å‰ä½ç½®</span>
                    <span class="status-value" id="location">{{ location if location else 'é’äº‘åŸ' }}</span>
                </div>
                <div class="status-line">
                    <span class="status-label">çµçŸ³</span>
                    <span class="status-value" id="gold">0</span>
                </div>
            </section>

            <section class="status-block">
                <h2>çŠ¶æ€æ•ˆæœ</h2>
                <div class="status-list" id="buff-list" aria-label="å¢ç›Šæ•ˆæœ">
                    {% for buff in buffs %}
                    <div class="status-list-item">{{ buff }}</div>
                    {% else %}
                    <div class="status-list-item">ï¼ˆæ— å¢ç›Šï¼‰</div>
                    {% endfor %}
                </div>
            </section>

            <section class="status-block">
                <h2>ç‰¹æ®ŠçŠ¶æ€</h2>
                <div class="status-list" id="special-status" aria-label="ç‰¹æ®ŠçŠ¶æ€">
                    {% for status in special_status %}
                    <div class="status-list-item">{{ status }}</div>
                    {% else %}
                    <div class="status-list-item">ï¼ˆæ­£å¸¸ï¼‰</div>
                    {% endfor %}
                </div>
            </section>

            <!-- åŠŸèƒ½ç½‘æ ¼ -->
            <nav class="function-grid" role="navigation" aria-label="æ¸¸æˆåŠŸèƒ½èœå•">
                <button class="function-link" data-modal="status" aria-label="æŸ¥çœ‹è¯¦ç»†çŠ¶æ€">çŠ¶æ€</button>
                <button class="function-link" data-modal="inventory" aria-label="æŸ¥çœ‹èƒŒåŒ…ç‰©å“">èƒŒåŒ…</button>
                <button class="function-link" data-modal="cultivation" aria-label="ä¿®ç‚¼ç³»ç»Ÿ">ä¿®ç‚¼</button>
                <button class="function-link" data-modal="achievement" aria-label="æŸ¥çœ‹æˆå°±">æˆå°±</button>
                <button class="function-link" data-modal="exploration" aria-label="æ¢ç´¢åŠŸèƒ½">æ¢ç´¢</button>
                <button class="function-link" data-modal="map" aria-label="æŸ¥çœ‹åœ°å›¾">åœ°å›¾</button>
                <button class="function-link" data-modal="quest" aria-label="æŸ¥çœ‹ä»»åŠ¡">ä»»åŠ¡</button>
                <button class="function-link" data-modal="save" aria-label="ä¿å­˜æ¸¸æˆ">ä¿å­˜</button>
                <button class="function-link" data-modal="load" aria-label="åŠ è½½æ¸¸æˆ">åŠ è½½</button>
                <button class="function-link" data-modal="help" aria-label="æŸ¥çœ‹å¸®åŠ©">å¸®åŠ©</button>
                <button class="function-link" data-modal="settings" aria-label="æ¸¸æˆè®¾ç½®">è®¾å®š</button>
                <button class="function-link" data-modal="exit" aria-label="é€€å‡ºæ¸¸æˆ">é€€å‡º</button>
            </nav>

            <!-- æˆå°±è¿›åº¦ -->
            <section class="achievement-progress" aria-label="æˆå°±è¿›åº¦">
                <div>æˆå°±ï¼š<span id="achievement-count" aria-label="å·²è§£é”æˆå°±æ•°é‡">0/30</span></div>
                <div>æˆå°±ç‚¹ï¼š<span id="achievement-points" aria-label="è·å¾—æˆå°±ç‚¹æ•°">0</span></div>
            </section>
        </aside>

        <!-- ä¸­å¤®å™äº‹åŒºåŸŸ -->
        <section class="narrative-log" id="narrative-log" role="log" aria-label="æ¸¸æˆå‰§æƒ…å’Œç³»ç»Ÿæ¶ˆæ¯" aria-live="polite">
            <div class="loading" id="loading" aria-label="æ­£åœ¨åŠ è½½æ¸¸æˆ">
                <div class="loading-spinner" aria-hidden="true"></div>
                <div>æ­£åœ¨å”¤é†’ä¿®ä»™ä¸–ç•Œ...</div>
            </div>
        </section>
    </main>

    <!-- åº•éƒ¨å‘½ä»¤åŒº -->
    <footer class="command-section" role="contentinfo">
        <div class="input-hint">ğŸ’¡ è¾“å…¥"å¸®åŠ©"æŸ¥çœ‹å…¨éƒ¨å¯ç”¨å‘½ä»¤ï¼ŒæŒ‰Tabé”®æ˜¾ç¤ºå‘½ä»¤æç¤º</div>
        <form class="input-line" onsubmit="event.preventDefault(); gameClient.executeCommand();" role="search">
            <label for="command-input" class="sr-only">æ¸¸æˆå‘½ä»¤è¾“å…¥</label>
            <input type="text"
                   class="command-input"
                   id="command-input"
                   placeholder="è¾“å…¥å‘½ä»¤ï¼Œå¦‚ï¼šæ¢ç´¢ã€æ”»å‡»å¦–å…½ã€ä½¿ç”¨å›å…ƒä¸¹â€¦â€¦"
                   autocomplete="off"
                   spellcheck="false"
                   aria-describedby="input-hint"
                   maxlength="100">
            <button type="submit" class="command-submit" aria-label="æ‰§è¡Œè¾“å…¥çš„å‘½ä»¤">æ‰§è¡Œ</button>
        </form>
        
        <!-- è‡ªåŠ¨å®Œæˆæç¤º -->
        <div class="autocomplete" id="autocomplete" role="listbox" aria-label="å‘½ä»¤å»ºè®®"></div>
    </footer>

    <!-- æµ®åŠ¨æç¤º -->
    <div class="tooltip" id="tooltip" role="tooltip" aria-hidden="true"></div>
    
    <!-- é€šç”¨æ¨¡æ€æ¡† -->
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-container">
            <button class="modal-close" aria-label="å…³é—­å¯¹è¯æ¡†">&times;</button>
            <div id="modal-content">
                <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- æ— éšœç¢è¾…åŠ© -->
    <div class="sr-only" aria-live="assertive" id="screen-reader-announcements"></div>

    <!-- è„šæœ¬åŠ è½½ -->
    <script>
        // è®¾ç½®å…¨å±€å˜é‡
        window.devMode = {{ 'true' if dev_mode else 'false' }};
        window.isNewSession = {{ 'true' if is_new_session else 'false' }};
        
        // æ€§èƒ½ç›‘æ§
        if (window.performance && window.performance.mark) {
            window.performance.mark('game-start');
        }
        
        // é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            if (window.devMode) {
                console.error('[DEV] JavaScripté”™è¯¯:', e.error);
            }
        });
        
        // æœªå¤„ç†çš„Promiseæ‹’ç»
        window.addEventListener('unhandledrejection', function(e) {
            if (window.devMode) {
                console.error('[DEV] æœªå¤„ç†çš„Promiseæ‹’ç»:', e.reason);
            }
        });
    </script>
    
    <!-- æ¸¸æˆæ ¸å¿ƒè„šæœ¬ -->
    <script src="/static/js/game_optimized.js" defer></script>
    
    <!-- å¯é€‰ï¼šæ€§èƒ½åˆ†æï¼ˆä»…å¼€å‘æ¨¡å¼ï¼‰ -->
    {% if dev_mode %}
    <script>
        // å¼€å‘æ¨¡å¼ä¸‹çš„æ€§èƒ½ç›‘æ§
        window.addEventListener('load', function() {
            if (window.performance && window.performance.getEntriesByType) {
                setTimeout(function() {
                    const navigation = window.performance.getEntriesByType('navigation')[0];
                    if (navigation) {
                        console.log('[DEV] é¡µé¢åŠ è½½æ€§èƒ½:');
                        console.log('  DNSæŸ¥æ‰¾:', Math.round(navigation.domainLookupEnd - navigation.domainLookupStart), 'ms');
                        console.log('  TCPè¿æ¥:', Math.round(navigation.connectEnd - navigation.connectStart), 'ms');
                        console.log('  è¯·æ±‚å“åº”:', Math.round(navigation.responseEnd - navigation.requestStart), 'ms');
                        console.log('  DOMæ„å»º:', Math.round(navigation.domContentLoadedEventEnd - navigation.responseEnd), 'ms');
                        console.log('  æ€»è®¡æ—¶é—´:', Math.round(navigation.loadEventEnd - navigation.navigationStart), 'ms');
                    }
                }, 1000);
            }
        });
    </script>
    {% endif %}
</body>
</html>

<!-- 
    ä¿®ä»™ä¸–ç•Œå¼•æ“ v2.0
    ä¸€ä¸ªæ²‰æµ¸å¼çš„æ–‡å­—ä¿®çœŸæ¨¡æ‹Ÿå™¨
    
    ç‰¹æ€§:
    - ğŸ¨ ä¼˜é›…çš„æ°´å¢¨é£ç•Œé¢è®¾è®¡
    - ğŸ® å®Œæ•´çš„ä¿®ä»™ä½“éªŒç³»ç»Ÿ
    - ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šè®¾å¤‡
    - â™¿ ä¼˜ç§€çš„æ— éšœç¢æ”¯æŒ
    - ğŸš€ é«˜æ€§èƒ½ä¼˜åŒ–
    - ğŸ”§ å¼€å‘è€…å‹å¥½çš„è°ƒè¯•åŠŸèƒ½
-->