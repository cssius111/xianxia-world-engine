<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®ä»™ä¸–ç•Œæ¨¡æ‹Ÿå™¨ - è¸ä¸Šä¿®ä»™ä¹‹è·¯</title>
    
    <!-- CSSæ ·å¼ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ink_style.css') }}">
    
    <!-- ç½‘ç«™å›¾æ ‡ -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    
    <!-- SEOå…ƒæ•°æ® -->
    <meta name="description" content="æ²‰æµ¸å¼ä¿®ä»™ä¸–ç•Œæ¨¡æ‹Ÿå™¨ï¼Œå¼€å¯ä½ çš„ä¼ å¥‡ä¿®ä»™ä¹‹æ—…">
    <meta name="keywords" content="ä¿®ä»™,æ¸¸æˆ,æ¨¡æ‹Ÿå™¨,RPG,ä¸­å›½é£,æ°´å¢¨">
    
    <!-- ç§»åŠ¨è®¾å¤‡ä¼˜åŒ– -->
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <style>
        /* æ¬¢è¿é¡µé¢ä¸“ç”¨æ ·å¼ */
        .welcome-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--brush-gold);
            border-radius: 50%;
            opacity: 0;
            animation: float 6s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { opacity: 0; transform: translateY(100vh) rotate(0deg); }
            50% { opacity: 0.8; transform: translateY(-100px) rotate(180deg); }
        }
        
        .welcome-subtitle {
            animation: fadeInUp 1s ease 0.5s both;
        }
        
        .welcome-actions {
            animation: fadeInUp 1s ease 1s both;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .save-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--brush-gold);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .version-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: var(--ink-lighter);
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- ç²’å­èƒŒæ™¯æ•ˆæœ -->
    <div class="welcome-particles" id="particles"></div>
    
    <!-- å¢¨æ™•è¿‡æ¸¡æ•ˆæœ -->
    <div class="ink-transition" id="inkTransition"></div>
    
    <!-- æ¬¢è¿é¡µé¢å†…å®¹ -->
    <div class="welcome-container">
        <h1 class="welcome-title">ä¿®ä»™ä¸–ç•Œæ¨¡æ‹Ÿå™¨</h1>
        <p class="welcome-subtitle">è¸ä¸Šä¿®ä»™ä¹‹è·¯ï¼Œè°±å†™ä¼ å¥‡äººç”Ÿ</p>
        
        <!-- å­˜æ¡£çŠ¶æ€ -->
        {% if save_exists %}
        <div class="save-status">
            <p><strong>ğŸ“ æ£€æµ‹åˆ°å­˜æ¡£æ–‡ä»¶</strong></p>
            <p>ä½ å¯ä»¥ç»§ç»­ä¹‹å‰çš„ä¿®ä»™ä¹‹æ—…ï¼Œæˆ–è€…å¼€å¯å…¨æ–°çš„ä¼ å¥‡ã€‚</p>
        </div>
        {% else %}
        <div class="save-status" style="border-color: var(--cloud-gray); background: rgba(176, 176, 176, 0.1);">
            <p><strong>ğŸ†• é¦–æ¬¡å¯åŠ¨</strong></p>
            <p>æ¬¢è¿æ¥åˆ°ä¿®ä»™ä¸–ç•Œï¼å‡†å¤‡å¼€å§‹ä½ çš„ä¿®ä»™ä¼ å¥‡å§ã€‚</p>
        </div>
        {% endif %}
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="welcome-actions">
            {% if save_exists %}
            <a href="{{ url_for('game') }}" class="welcome-button">
                ğŸ“– ç»§ç»­æ¸¸æˆ
            </a>
            <a href="{{ url_for('intro') }}" class="welcome-button secondary">
                ğŸ†• å¼€å§‹æ–°æ¸¸æˆ
            </a>
            {% else %}
            <a href="{{ url_for('intro') }}" class="welcome-button">
                ğŸš€ å¼€å§‹æ¸¸æˆ
            </a>
            {% endif %}
            
            <a href="{{ url_for('intro', mode='dev') }}" class="welcome-button secondary">
                ğŸ”§ å¼€å‘è€…æ¨¡å¼
            </a>
        </div>
        
        <!-- æ¸¸æˆä»‹ç» -->
        <div class="game-intro" style="margin-top: 40px; max-width: 600px; text-align: center;">
            <h3 style="color: var(--brush-gold); margin-bottom: 20px;">ğŸŒŸ æ¸¸æˆç‰¹è‰²</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; text-align: center;">
                <div>
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ§˜</div>
                    <h4>ä¿®ç‚¼ç³»ç»Ÿ</h4>
                    <p style="font-size: 0.9rem; color: var(--ink-lighter);">ä»ç‚¼æ°”æœŸåˆ°åŒ–ç¥æœŸï¼Œä½“éªŒå®Œæ•´çš„ä¿®ç‚¼å†ç¨‹</p>
                </div>
                <div>
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ—ºï¸</div>
                    <h4>å¹¿é˜”ä¸–ç•Œ</h4>
                    <p style="font-size: 0.9rem; color: var(--ink-lighter);">æ¢ç´¢ç¥ç§˜çš„ä¿®ä»™ä¸–ç•Œï¼Œå‘ç°éšè—çš„ç§˜å¯†</p>
                </div>
                <div>
                    <div style="font-size: 2rem; margin-bottom: 10px;">âš”ï¸</div>
                    <h4>æˆ˜æ–—å†’é™©</h4>
                    <p style="font-size: 0.9rem; color: var(--ink-lighter);">ä¸å¦–å…½æˆ˜æ–—ï¼ŒæŒ‘æˆ˜å¼ºæ•Œï¼Œè·å¾—çè´µå®ç‰©</p>
                </div>
                <div>
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ›ï¸</div>
                    <h4>é—¨æ´¾ç³»ç»Ÿ</h4>
                    <p style="font-size: 0.9rem; color: var(--ink-lighter);">åŠ å…¥é—¨æ´¾ï¼Œå­¦ä¹ é«˜æ·±åŠŸæ³•ï¼Œç»“äº¤é“å‹</p>
                </div>
            </div>
        </div>
        
        <!-- æ“ä½œè¯´æ˜ -->
        <div class="game-tips" style="margin-top: 40px; padding: 20px; background: rgba(0, 0, 0, 0.1); border-radius: 8px; max-width: 500px;">
            <h4 style="color: var(--brush-gold); margin-bottom: 15px;">ğŸ’¡ å¿«é€Ÿå…¥é—¨</h4>
            <ul style="text-align: left; color: var(--ink-lighter); line-height: 1.8;">
                <li>è¾“å…¥å‘½ä»¤è¿›è¡Œæ¸¸æˆï¼Œå¦‚ï¼š<code style="background: rgba(0,0,0,0.2); padding: 2px 4px; border-radius: 3px;">æ¢ç´¢</code>ã€<code style="background: rgba(0,0,0,0.2); padding: 2px 4px; border-radius: 3px;">ä¿®ç‚¼</code></li>
                <li>ç‚¹å‡»å·¦ä¾§èœå•å¿«é€Ÿè®¿é—®å„ç§åŠŸèƒ½</li>
                <li>ä½¿ç”¨ <kbd>F1</kbd> é”®éšæ—¶æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</li>
                <li>æ¸¸æˆä¼šè‡ªåŠ¨ä¿å­˜è¿›åº¦ï¼Œä¹Ÿå¯æ‰‹åŠ¨ä¿å­˜</li>
            </ul>
        </div>
    </div>
    
    <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
    <div class="version-info">
        <div>ä¿®ä»™ä¸–ç•Œå¼•æ“ v2.0</div>
        <div>Build {{ build_time or '2025.06.22' }}</div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // ç²’å­åŠ¨ç”»æ•ˆæœ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 4) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // å¢¨æ™•è¿‡æ¸¡æ•ˆæœ
        function inkTransition(callback) {
            const inkTransition = document.getElementById('inkTransition');
            inkTransition.classList.add('active');
            
            setTimeout(() => {
                if (callback) callback();
            }, 500);
        }
        
        // æŒ‰é’®ç‚¹å‡»æ•ˆæœ
        function setupButtonEffects() {
            const buttons = document.querySelectorAll('.welcome-button');
            
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const href = this.href;
                    
                    // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ (å¦‚æœéŸ³é¢‘ç³»ç»Ÿå¯ç”¨)
                    if (window.AudioContext || window.webkitAudioContext) {
                        playClickSound();
                    }
                    
                    // å¢¨æ™•è¿‡æ¸¡
                    inkTransition(() => {
                        window.location.href = href;
                    });
                });
                
                // æ‚¬åœæ•ˆæœ
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-3px) scale(1.02)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(-3px) scale(1)';
                });
            });
        }
        
        // ç®€å•çš„ç‚¹å‡»éŸ³æ•ˆ
        function playClickSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (error) {
                // é™é»˜å¤±è´¥
            }
        }
        
        // é”®ç›˜å¿«æ·é”®
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Enteré”®å¿«é€Ÿå¼€å§‹æ¸¸æˆ
                if (e.key === 'Enter') {
                    const primaryButton = document.querySelector('.welcome-button:not(.secondary)');
                    if (primaryButton) {
                        primaryButton.click();
                    }
                }
                
                // Ctrl+D å¼€å‘è€…æ¨¡å¼
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    const devButton = document.querySelector('[href*="mode=dev"]');
                    if (devButton) {
                        devButton.click();
                    }
                }
            });
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ® ä¿®ä»™ä¸–ç•Œæ¨¡æ‹Ÿå™¨æ¬¢è¿é¡µé¢åŠ è½½å®Œæˆ');
            
            createParticles();
            setupButtonEffects();
            setupKeyboardShortcuts();
            
            // æ˜¾ç¤ºåŠ è½½å®ŒæˆåŠ¨ç”»
            document.body.style.opacity = '0';
            document.body.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                document.body.style.transition = 'all 0.5s ease';
                document.body.style.opacity = '1';
                document.body.style.transform = 'scale(1)';
            }, 100);
            
            // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
            if (!window.fetch || !window.Promise) {
                const warning = document.createElement('div');
                warning.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0;
                    background: #ff4444; color: white; padding: 10px;
                    text-align: center; z-index: 10000;
                `;
                warning.textContent = 'âš ï¸ æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œå¯èƒ½å½±å“æ¸¸æˆä½“éªŒã€‚å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ç°ä»£æµè§ˆå™¨ã€‚';
                document.body.prepend(warning);
            }
            
            // æ€§èƒ½æ£€æµ‹
            if ('performance' in window) {
                window.addEventListener('load', function() {
                    const loadTime = performance.now();
                    if (loadTime > 3000) {
                        console.warn('é¡µé¢åŠ è½½è¾ƒæ…¢:', loadTime + 'ms');
                    }
                });
            }
        });
        
        // é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('é¡µé¢é”™è¯¯:', e.error);
            
            // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed; bottom: 20px; left: 20px;
                background: rgba(255, 68, 68, 0.9); color: white;
                padding: 10px 15px; border-radius: 5px;
                font-size: 0.9rem; max-width: 300px;
            `;
            errorDiv.textContent = 'å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œä½†è¿™ä¸å½±å“æ¸¸æˆæ­£å¸¸è¿è¡Œã€‚';
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 5000);
        });
        
        // åœ¨çº¿çŠ¶æ€æ£€æµ‹
        function updateOnlineStatus() {
            const status = navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿';
            console.log('ç½‘ç»œçŠ¶æ€:', status);
            
            if (!navigator.onLine) {
                const offlineDiv = document.createElement('div');
                offlineDiv.style.cssText = `
                    position: fixed; top: 50%; left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(255, 165, 0, 0.9); color: white;
                    padding: 20px; border-radius: 8px;
                    text-align: center; z-index: 10000;
                `;
                offlineDiv.innerHTML = `
                    <h3>ğŸ“¶ ç½‘ç»œè¿æ¥ä¸­æ–­</h3>
                    <p>æ¸¸æˆå¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚</p>
                `;
                document.body.appendChild(offlineDiv);
                
                // æ¢å¤è¿æ¥æ—¶ç§»é™¤æç¤º
                const onlineHandler = () => {
                    if (offlineDiv.parentNode) {
                        offlineDiv.parentNode.removeChild(offlineDiv);
                    }
                    window.removeEventListener('online', onlineHandler);
                };
                window.addEventListener('online', onlineHandler);
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
    </script>
    
    <!-- é¢„åŠ è½½æ¸¸æˆèµ„æº -->
    <link rel="prefetch" href="{{ url_for('static', filename='js/game_controller.js') }}">
    <link rel="prefetch" href="{{ url_for('static', filename='js/modules/ui_controller.js') }}">
    <link rel="prefetch" href="{{ url_for('static', filename='js/modules/audio_controller.js') }}">
</body>
</html>