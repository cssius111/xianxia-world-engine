# 🏛️ 修仙世界拍卖行系统 - 完整功能文档

## 📋 系统概述

修仙世界拍卖行系统是一个功能完整、高度沉浸的拍卖玩法模块。系统实现了从进入拍卖行到拍后事件的完整流程，包含智能NPC竞价、动态事件触发、VIP特权等丰富功能。

## 🏗️ 系统架构

### 核心模块
```
xwe/features/
├── auction_system.py        # 拍卖系统核心逻辑
├── auction_commands.py      # 命令处理接口
├── interactive_auction.py   # 交互式竞拍体验
└── auction_integration.py   # 系统集成指南

xwe/data/auction/
├── auction_config.json      # 系统配置
├── auction_items.json       # 物品数据库
└── auction_npcs.json        # NPC配置
```

### 数据流程
```
玩家输入 → 命令解析 → 拍卖系统 → 竞价逻辑 → 事件触发 → 结果输出
    ↑                                                      ↓
    └─────────────── 游戏状态更新 ←───────────────────┘
```

## ✨ 功能特性详解

### 1. 🎯 拍卖模式系统

#### 英式拍卖（主要模式）
- **机制**：价格递增，价高者得
- **流程**：起拍价 → 竞价 → 倒计时 → 成交
- **特点**：最常见，适合大多数物品

#### 荷兰式拍卖（计划中）
- **机制**：价格递减，首位接受者得
- **适用**：时间敏感的压轴物品
- **策略**：考验玩家的心理博弈

#### 密封投标（VIP专属）
- **机制**：暗标竞价，最高价得标
- **优势**：避免恶意抬价
- **限制**：仅VIP会员可用

### 2. 🤖 NPC智能系统

#### NPC性格类型
| 类型 | 特征 | 出价风格 | 财富水平 | 特殊行为 |
|------|------|----------|----------|----------|
| 激进型 | 急躁、冲动 | 快速加价 | 中等 | 易怒，可能恶意竞价 |
| 保守型 | 谨慎、理性 | 小幅加价 | 高 | 设定严格预算上限 |
| 策略型 | 精明、计算 | 伺机而动 | 中高 | 最后时刻出价 |
| 神秘型 | 深不可测 | 不规律 | 极高 | 可能一口价压制 |
| 暴发户 | 炫富、虚荣 | 大幅加价 | 高 | 为面子不计成本 |

#### NPC决策算法
```python
# 简化的决策逻辑
def npc_bid_decision(npc, item, current_price):
    # 价值评估
    perceived_value = item.base_value * (1 + random(-0.2, 0.2))
    
    # 性格影响
    if npc.type == "aggressive":
        perceived_value *= 1.3
    elif npc.type == "conservative":
        perceived_value *= 0.9
    
    # 财富限制
    max_affordable = npc.wealth * 0.3  # 最多用30%财富
    
    # 决策
    if current_price < min(perceived_value, max_affordable):
        return True, calculate_bid_amount(...)
    return False, 0
```

### 3. 🎭 动态事件系统

#### 事件类型与触发条件
| 事件 | 触发概率 | 触发条件 | 效果 |
|------|----------|----------|------|
| 仇敌恶意抬价 | 60% | 存在仇恨关系 | 价格上涨30-50% |
| 突发劫案 | 2% | 随机 | 中断拍卖，触发战斗 |
| 大能降临 | 3% | 高价值物品 | 改变竞价格局 |
| 虚假报价 | 5% | 价格过高时 | 扰乱者被逐出 |
| 最后加价 | 10% | 倒计时阶段 | 突然有人加价 |

#### 事件处理流程
1. **检测触发条件**
2. **计算触发概率**
3. **执行事件效果**
4. **更新拍卖状态**
5. **生成剧情文本**

### 4. 💎 VIP系统

#### VIP资格获取
- **消费门槛**：累计消费5万灵石
- **等级要求**：角色等级30+
- **特殊途径**：完成特定任务

#### VIP特权列表
| 特权 | 描述 | 游戏影响 |
|------|------|----------|
| 匿名竞拍 | 隐藏身份信息 | 避免仇恨，减少劫杀 |
| 专属包厢 | 独立竞拍空间 | 提升体验，专属服务 |
| 自动代理 | 设定上限自动出价 | 省时省力，避免失误 |
| 优先座位 | 最佳观察位置 | 更早获得物品信息 |
| 手续费减免 | 降低10%手续费 | 节省开支 |

### 5. 🗡️ 拍后事件链

#### 劫杀事件
```
触发条件：
- 拍得物品价值 > 3万灵石
- 玩家低调值 < 50
- 随机概率通过

事件流程：
1. 离开拍卖行时察觉异常
2. 遭遇蒙面劫匪
3. 选择：战斗/交出物品/谈判
4. 根据选择触发不同结果
```

#### 结盟机会
```
触发条件：
- 展现雄厚财力
- 与某NPC竞价互动良好
- 玩家魅力值 > 60

事件效果：
- 获得NPC好感
- 可能获得隐藏任务
- 开启特殊商店
```

## 📊 数据配置

### 物品配置结构
```json
{
  "id": "unique_identifier",
  "name": "物品名称",
  "description": "详细描述",
  "tier": "low/mid/high/legendary",
  "base_price": 1000,
  "max_price": 5000,
  "effects": {
    "attribute_bonus": {},
    "special_ability": []
  },
  "event_probability": 0.1,
  "popularity": 0.8
}
```

### NPC配置结构
```json
{
  "type": "aggressive",
  "name_pool": ["名字1", "名字2"],
  "bid_style": "rapid",
  "price_tolerance": 1.5,
  "personality_traits": {
    "patience": 0.3,
    "aggression": 0.9,
    "wealth": 0.7
  },
  "speech_patterns": ["台词1", "台词2"]
}
```

## 🎮 使用指南

### 命令列表
| 命令 | 参数 | 描述 | 示例 |
|------|------|------|------|
| 拍卖行 | 无 | 进入拍卖行 | `拍卖行` |
| 参加拍卖 | 类型(可选) | 参加拍卖会 | `参加拍卖` |
| 出价 | 金额 | 竞拍出价 | `出价 5000` |
| 放弃 | 无 | 放弃当前物品 | `放弃` |
| 自动出价 | 上限 | VIP自动竞价 | `自动出价 10000` |
| 离开拍卖行 | 无 | 离开 | `离开拍卖行` |
| 拍卖帮助 | 无 | 查看帮助 | `拍卖帮助` |

### 竞拍策略建议
1. **评估价值**：了解物品真实价值，设定心理上限
2. **观察对手**：注意其他竞拍者的出价模式和财力
3. **时机把握**：在合适时机出价，避免过早暴露意图
4. **资金管理**：合理分配资金，不要在单件物品上耗尽
5. **安全考虑**：高价物品需考虑拍后安全

## 🔧 集成方法

### 1. 基础集成
```python
# 在游戏主循环中
from xwe.features import auction_command_handler

# 处理命令
if command.startswith(("拍卖", "出价")):
    result = auction_command_handler.handle_auction_command(
        player, command, params
    )
    print(result)
```

### 2. 地点集成
```python
# 添加拍卖行地点
locations["tiannan_auction"] = {
    "name": "天宝拍卖行",
    "description": "最大的拍卖行...",
    "connections": ["tiannan_market"],
    "features": ["auction_house"]
}
```

### 3. 事件集成
```python
# 定时拍卖会
if game_time.day % 7 == 0:  # 每周
    announce_special_auction()
```

## 📈 扩展计划

### 近期目标
- [ ] 完善荷兰式拍卖
- [ ] 添加拍卖预告系统
- [ ] 实现委托拍卖功能
- [ ] 增加更多特殊事件

### 远期规划
- [ ] 跨服拍卖系统
- [ ] 拍卖行等级系统
- [ ] 专业鉴定师职业
- [ ] 拍品真伪鉴别玩法

## 🐛 已知问题
1. 交互模式下需要手动输入（计划添加UI）
2. NPC财富暂未与经济系统联动
3. 部分罕见事件触发率需要平衡

## 📝 版本历史
- **v1.0.0** (2025-06-04)：初始版本发布
  - 实现核心拍卖功能
  - 添加5种NPC性格
  - 支持基础事件系统

---

*修仙世界拍卖行系统 - 让修仙之路更加精彩*