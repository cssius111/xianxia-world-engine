--- a/tests/e2e_full.spec.ts
+++ b/tests/e2e_full.spec.ts
@@ -28,15 +28,6 @@ test.describe.configure({ mode: 'serial' }); // Run tests sequentially
 // Helper to wait for async operations
 const wait = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));
 
-// Helper to clear session storage
-const clearSession = async (page: Page) => {
-  await page.evaluate(() => {
-    sessionStorage.clear();
-    localStorage.clear();
-  });
-  // Clear cookies
-  const context = page.context();
-  await context.clearCookies();
-};
-
 // Test suite
@@ -54,6 +45,13 @@ test.describe('Xianxia World Engine - Comprehensive E2E Tests', () => {
     context = await browser.newContext({
       permissions: ['clipboard-read', 'clipboard-write'],
       acceptDownloads: true,
     });
+    
+    // Add init script to safely clear sessionStorage
+    await context.addInitScript(() => {
+      try { sessionStorage.clear(); } catch { /* ignore */ }
+      try { localStorage.clear(); } catch { /* ignore */ }
+    });
   });
 
   test.beforeEach(async () => {
     page = await context.newPage();
-    // Clear session before each test
-    await clearSession(page);
+    // Clear cookies before each test
+    await context.clearCookies();
   });
