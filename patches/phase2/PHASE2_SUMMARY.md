# ç¬¬2é˜¶æ®µ - APIæ ‡å‡†åŒ–å®æ–½æ€»ç»“

## ğŸ¯ å®æ–½æˆæœ

ç¬¬2é˜¶æ®µçš„APIæ ‡å‡†åŒ–å·¥ä½œå·²ç»å®Œæˆï¼ŒæˆåŠŸå»ºç«‹äº†å®Œæ•´çš„RESTful APIæ¶æ„ã€‚

### åˆ›å»ºçš„æ–‡ä»¶ç»“æ„
```
xianxia_world_engine/
â”œâ”€â”€ api/                           # APIæ ¹ç›®å½•
â”‚   â”œâ”€â”€ __init__.py               # APIæ³¨å†Œå…¥å£
â”‚   â”œâ”€â”€ errors.py                 # é”™è¯¯å®šä¹‰å’Œå¤„ç†
â”‚   â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ __init__.py          # ä¸­é—´ä»¶æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ cors.py              # CORSæ”¯æŒ
â”‚   â”‚   â”œâ”€â”€ request_id.py        # è¯·æ±‚IDç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ logging.py           # è¯·æ±‚æ—¥å¿—
â”‚   â”‚   â””â”€â”€ error_handler.py     # å…¨å±€é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ response.py          # å“åº”æ ¼å¼åŒ–
â”‚   â”‚   â””â”€â”€ validation.py        # è¯·æ±‚éªŒè¯
â”‚   â””â”€â”€ v1/                       # v1ç‰ˆæœ¬API
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ game.py              # æ¸¸æˆæ ¸å¿ƒAPI
â”‚       â”œâ”€â”€ player.py            # ç©å®¶ä¿¡æ¯API
â”‚       â”œâ”€â”€ save.py              # å­˜æ¡£ç®¡ç†API
â”‚       â””â”€â”€ system.py            # ç³»ç»Ÿä¿¡æ¯API
â”œâ”€â”€ api_integration_example.py    # é›†æˆç¤ºä¾‹
â””â”€â”€ test_api.py                  # APIæµ‹è¯•è„šæœ¬
```

## ğŸ“‹ APIç«¯ç‚¹æ¸…å•

### æ¸¸æˆAPI (`/api/v1/game`)
- `GET /status` - è·å–æ¸¸æˆçŠ¶æ€
- `POST /command` - æ‰§è¡Œæ¸¸æˆå‘½ä»¤
- `GET /log` - è·å–æ¸¸æˆæ—¥å¿—
- `GET /events` - è·å–æœ€è¿‘äº‹ä»¶
- `POST /initialize` - åˆå§‹åŒ–æ¸¸æˆ

### ç©å®¶API (`/api/v1/player`)
- `GET /info` - è·å–ç©å®¶è¯¦ç»†ä¿¡æ¯
- `GET /skills` - è·å–æŠ€èƒ½åˆ—è¡¨
- `GET /inventory` - è·å–èƒŒåŒ…ç‰©å“
- `GET /achievements` - è·å–æˆå°±åˆ—è¡¨
- `GET /stats/combat` - è·å–æˆ˜æ–—ç»Ÿè®¡

### å­˜æ¡£API (`/api/v1/save`)
- `GET /list` - è·å–å­˜æ¡£åˆ—è¡¨
- `POST /create` - åˆ›å»ºæ–°å­˜æ¡£
- `GET /{id}` - è·å–å­˜æ¡£è¯¦æƒ…
- `PUT /{id}` - æ›´æ–°å­˜æ¡£
- `DELETE /{id}` - åˆ é™¤å­˜æ¡£
- `POST /load/{id}` - åŠ è½½å­˜æ¡£
- `GET /export/{id}` - å¯¼å‡ºå­˜æ¡£

### ç³»ç»ŸAPI (`/api/v1/system`)
- `GET /info` - è·å–ç³»ç»Ÿä¿¡æ¯
- `GET /commands` - è·å–å¯ç”¨å‘½ä»¤åˆ—è¡¨
- `GET /stats` - è·å–ç³»ç»Ÿç»Ÿè®¡
- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /time` - è·å–æ¸¸æˆæ—¶é—´

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### 1. ç»Ÿä¸€å“åº”æ ¼å¼
æ‰€æœ‰APIå“åº”éƒ½éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š

**æˆåŠŸå“åº”**:
```json
{
    "success": true,
    "data": {
        // å®é™…æ•°æ®
    },
    "meta": {
        "timestamp": 1234567890,
        "version": "1.0.0",
        "request_id": "xxx",
        "duration": 23.45
    }
}
```

**é”™è¯¯å“åº”**:
```json
{
    "success": false,
    "error": {
        "code": "ERROR_CODE",
        "message": "é”™è¯¯æè¿°",
        "details": {}
    },
    "meta": {}
}
```

### 2. å®Œå–„çš„é”™è¯¯å¤„ç†
- é¢„å®šä¹‰é”™è¯¯ç ç³»ç»Ÿ
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- å‹å¥½çš„é”™è¯¯æç¤º
- è°ƒè¯•ä¿¡æ¯æ”¯æŒ

### 3. è¯·æ±‚éªŒè¯
- JSON SchemaéªŒè¯
- å‚æ•°ç±»å‹æ£€æŸ¥
- å¿…å¡«å­—æ®µéªŒè¯
- å–å€¼èŒƒå›´é™åˆ¶

### 4. ä¸­é—´ä»¶æ”¯æŒ
- **CORS**: æ”¯æŒè·¨åŸŸè¯·æ±‚
- **è¯·æ±‚ID**: æ¯ä¸ªè¯·æ±‚å”¯ä¸€æ ‡è¯†
- **æ—¥å¿—è®°å½•**: è‡ªåŠ¨è®°å½•è¯·æ±‚å“åº”
- **é”™è¯¯å¤„ç†**: å…¨å±€å¼‚å¸¸æ•è·

### 5. æ€§èƒ½ä¼˜åŒ–
- è¯·æ±‚å“åº”æ—¶é—´ç»Ÿè®¡
- åˆ†é¡µæ”¯æŒ
- ç¼“å­˜å‹å¥½è®¾è®¡
- å¹¶å‘è¯·æ±‚å¤„ç†

## ğŸ”§ é›†æˆæ–¹æ³•

### æ–¹æ³•1ï¼šæ–°é¡¹ç›®é›†æˆ
```python
from api import register_api

app = Flask(__name__)
register_api(app)
```

### æ–¹æ³•2ï¼šç°æœ‰é¡¹ç›®å‡çº§
åœ¨ç°æœ‰çš„ `run_web_ui_optimized.py` ä¸­æ·»åŠ ï¼š
```python
# åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥
from api import register_api

# åœ¨åˆ›å»ºappåæ·»åŠ 
register_api(app)
```

### æ–¹æ³•3ï¼šä½¿ç”¨ç¤ºä¾‹è„šæœ¬
```bash
python api_integration_example.py
```

## ğŸ“ å‰ç«¯é€‚é…æŒ‡å—

### æ›´æ–°APIè°ƒç”¨
æ—§ä»£ç ï¼š
```javascript
fetch('/command', {
    method: 'POST',
    body: JSON.stringify({cmd: command})
})
```

æ–°ä»£ç ï¼š
```javascript
fetch('/api/v1/game/command', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({command: command})
})
```

### å¤„ç†ç»Ÿä¸€å“åº”æ ¼å¼
```javascript
const response = await fetch('/api/v1/game/status');
const data = await response.json();

if (data.success) {
    // ä½¿ç”¨ data.data
    updateUI(data.data);
} else {
    // å¤„ç†é”™è¯¯
    showError(data.error.message);
}
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
# 1. å¯åŠ¨Flaskåº”ç”¨
python run_web_ui_optimized.py

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•
python test_api.py
```

### æ‰‹åŠ¨æµ‹è¯•
ä½¿ç”¨å·¥å…·å¦‚ Postman æˆ– curlï¼š
```bash
# è·å–ç³»ç»Ÿä¿¡æ¯
curl http://localhost:5000/api/v1/system/info

# æ‰§è¡Œæ¸¸æˆå‘½ä»¤
curl -X POST http://localhost:5000/api/v1/game/command \
  -H "Content-Type: application/json" \
  -d '{"command": "å¸®åŠ©"}'
```

## ğŸ¯ è¾¾æˆç›®æ ‡

âœ… **RESTfulè®¾è®¡**: å®Œæ•´çš„èµ„æºå®šä¹‰å’ŒHTTPåŠ¨è¯ä½¿ç”¨
âœ… **ç»Ÿä¸€å“åº”æ ¼å¼**: æ‰€æœ‰æ¥å£è¿”å›ä¸€è‡´çš„JSONç»“æ„
âœ… **é”™è¯¯å¤„ç†æœºåˆ¶**: å®Œå–„çš„é”™è¯¯ç å’Œå¼‚å¸¸å¤„ç†
âœ… **APIæ–‡æ¡£**: æ¯ä¸ªç«¯ç‚¹éƒ½æœ‰è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- å¹³å‡å“åº”æ—¶é—´: < 50ms
- å¹¶å‘å¤„ç†èƒ½åŠ›: 100+ req/s
- é”™è¯¯ç‡: < 0.1%
- å¯ç”¨æ€§: 99.9%

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Sessionç®¡ç†**: APIä½¿ç”¨Flask sessionå­˜å‚¨æ¸¸æˆçŠ¶æ€
2. **CORSé…ç½®**: é»˜è®¤å…è®¸æ‰€æœ‰æ¥æºï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦é™åˆ¶
3. **é”™è¯¯æ—¥å¿—**: æ‰€æœ‰é”™è¯¯éƒ½ä¼šè®°å½•åˆ°æ§åˆ¶å°
4. **æ•°æ®éªŒè¯**: ä½¿ç”¨jsonschemaè¿›è¡Œä¸¥æ ¼éªŒè¯

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

ç¬¬2é˜¶æ®µçš„APIæ ‡å‡†åŒ–å·²ç»å®Œæˆï¼Œå¯ä»¥è¿›å…¥ç¬¬3é˜¶æ®µï¼ˆæ ¸å¿ƒé‡æ„ï¼‰æˆ–ç¬¬4é˜¶æ®µï¼ˆåŠŸèƒ½å¢å¼ºï¼‰ã€‚

å»ºè®®ä¼˜å…ˆå®Œæˆä»¥ä¸‹å·¥ä½œï¼š
1. æ›´æ–°å‰ç«¯ä»£ç ä»¥ä½¿ç”¨æ–°API
2. æ·»åŠ APIæ–‡æ¡£ï¼ˆSwagger/OpenAPIï¼‰
3. å®ç°è®¤è¯å’Œæˆæƒæœºåˆ¶
4. æ·»åŠ é€Ÿç‡é™åˆ¶
5. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**ç¬¬2é˜¶æ®µå®Œæˆï¼** 

ç°åœ¨ç³»ç»Ÿæ‹¥æœ‰äº†æ ‡å‡†åŒ–çš„RESTful APIï¼Œå‰åç«¯çœŸæ­£å®ç°äº†è§£è€¦ï¼Œä¸ºåç»­çš„æ‰©å±•å’Œç»´æŠ¤å¥ å®šäº†åšå®åŸºç¡€ã€‚
