# 项目清理和重构指南

本文档说明如何使用提供的脚本来清理和重构仙侠世界引擎项目。

## 问题概述

您的项目存在以下主要问题：

1. **严重的文件重复**
   - `spiritual_root.json` 在4个不同位置
   - 多个版本的 `combat_system.json`（普通版、优化版、v2版等）
   - 同样的配置文件散布在多个目录

2. **混乱的目录结构**
   - 三个不同的restructured目录
   - 没有清晰的文件组织规范

3. **版本管理问题**
   - 同一个配置文件有多个版本（_v2, _enhanced, _optimized等后缀）
   - 应该使用Git版本控制而不是文件名来管理版本

## 使用步骤

### 第一步：清理重复文件

运行清理脚本来删除完全重复的文件：

```bash
cd /Users/chenpinle/Desktop/杂/pythonProject/xianxia_world_engine
python scripts/cleanup_duplicates.py
```

这个脚本会：
- 扫描所有JSON文件
- 找出内容完全相同的文件
- 保留最新版本，删除其他重复
- 创建备份以防需要恢复
- 生成详细的清理报告

### 第二步：重构目录结构

运行重构脚本来重新组织文件：

```bash
python scripts/restructure_project.py
```

建议先选择"试运行"模式查看将要执行的操作。

新的目录结构将是：
```
data/
├── game_configs/      # 游戏配置文件
│   ├── character/     # 角色相关
│   ├── combat/        # 战斗系统
│   ├── cultivation/   # 修炼系统
│   ├── items/         # 物品系统
│   ├── skills/        # 技能系统
│   ├── world/         # 世界设定
│   ├── npc/           # NPC配置
│   └── system/        # 系统配置
├── game_data/         # 游戏数据
│   ├── templates/     # 模板文件
│   ├── formulas/      # 公式配置
│   └── events/        # 事件配置
└── deprecated/        # 废弃文件
```

### 第三步：更新代码引用

重构后需要更新代码中的文件路径引用：

```bash
python update_paths.py
```

这个脚本会自动更新所有Python文件中的路径引用。

### 第四步：手动处理

某些文件需要手动合并，脚本会生成建议列表。例如：
- `spiritual_root.json` 的多个版本需要合并最有用的配置
- 不同版本的 `combat_system.json` 需要整合

## 重要提示

1. **备份**：所有操作都会创建备份，备份目录名包含时间戳
2. **交互式确认**：脚本会询问每个操作，可以选择跳过
3. **报告**：每次运行都会生成Markdown格式的详细报告
4. **版本控制**：完成清理后，建议立即提交到Git

## 后续建议

1. **建立规范**
   - 制定清晰的文件命名规范
   - 规定每种类型的配置文件应该放在哪里
   - 使用Git管理版本，而不是创建多个文件

2. **代码审查**
   - 检查所有数据加载代码
   - 确保路径更新正确
   - 运行测试确保功能正常

3. **持续维护**
   - 定期运行清理脚本
   - 保持目录结构整洁
   - 及时删除废弃文件

## 问题排查

如果遇到问题：
1. 查看生成的报告文件了解详情
2. 检查备份目录恢复需要的文件
3. 使用Git查看文件历史

祝您清理顺利！
